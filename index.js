"use strict";var q=Object.defineProperty;var V=(e,i,a)=>i in e?q(e,i,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[i]=a;var h=(e,i,a)=>V(e,typeof i!="symbol"?i+"":i,a);var c=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},s={},j={},C={},p={},F=c&&c.__awaiter||function(e,i,a,r){function t(n){return n instanceof a?n:new a(function(o){o(n)})}return new(a||(a=Promise))(function(n,o){function u(l){try{d(r.next(l))}catch(g){o(g)}}function f(l){try{d(r.throw(l))}catch(g){o(g)}}function d(l){l.done?n(l.value):t(l.value).then(u,f)}d((r=r.apply(e,i||[])).next())})};Object.defineProperty(p,"__esModule",{value:!0});p.run_before=p.run_after=void 0;function Y(e){return function(a,r,t){return Object.assign(Object.assign({},t),{value(...n){return F(this,void 0,void 0,function*(){const o=yield t.value(...n);return yield e(o),o})}})}}p.run_after=Y;function G(e){return function(a,r,t){return Object.assign(Object.assign({},t),{value(...n){return F(this,void 0,void 0,function*(){return yield e(),yield t.value(...n)})}})}}p.run_before=G;(function(e){var i=c&&c.__createBinding||(Object.create?function(r,t,n,o){o===void 0&&(o=n);var u=Object.getOwnPropertyDescriptor(t,n);(!u||("get"in u?!t.__esModule:u.writable||u.configurable))&&(u={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(r,o,u)}:function(r,t,n,o){o===void 0&&(o=n),r[o]=t[n]}),a=c&&c.__exportStar||function(r,t){for(var n in r)n!=="default"&&!Object.prototype.hasOwnProperty.call(t,n)&&i(t,r,n)};Object.defineProperty(e,"__esModule",{value:!0}),a(p,e)})(C);var H=c&&c.__createBinding||(Object.create?function(e,i,a,r){r===void 0&&(r=a);var t=Object.getOwnPropertyDescriptor(i,a);(!t||("get"in t?!i.__esModule:t.writable||t.configurable))&&(t={enumerable:!0,get:function(){return i[a]}}),Object.defineProperty(e,r,t)}:function(e,i,a,r){r===void 0&&(r=a),e[r]=i[a]}),I=c&&c.__setModuleDefault||(Object.create?function(e,i){Object.defineProperty(e,"default",{enumerable:!0,value:i})}:function(e,i){e.default=i}),J=c&&c.__importStar||function(e){if(e&&e.__esModule)return e;var i={};if(e!=null)for(var a in e)a!=="default"&&Object.prototype.hasOwnProperty.call(e,a)&&H(i,e,a);return I(i,e),i};Object.defineProperty(j,"__esModule",{value:!0});j.guard=void 0;const z=J(C);j.guard=z;var A={},P={};Object.defineProperty(P,"__esModule",{value:!0});P.hash_time33=void 0;function Q(e){let i=5381,a=e.length;for(;a;)i=i*33^e.codePointAt(--a);return i>>>0}P.hash_time33=Q;(function(e){var i=c&&c.__createBinding||(Object.create?function(r,t,n,o){o===void 0&&(o=n);var u=Object.getOwnPropertyDescriptor(t,n);(!u||("get"in u?!t.__esModule:u.writable||u.configurable))&&(u={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(r,o,u)}:function(r,t,n,o){o===void 0&&(o=n),r[o]=t[n]}),a=c&&c.__exportStar||function(r,t){for(var n in r)n!=="default"&&!Object.prototype.hasOwnProperty.call(t,n)&&i(t,r,n)};Object.defineProperty(e,"__esModule",{value:!0}),a(P,e)})(A);var w={};Object.defineProperty(w,"__esModule",{value:!0});w.test=void 0;w.test=1;var _={},E={},v={};Object.defineProperty(v,"__esModule",{value:!0});v.merge_obj=v.applyMixins=void 0;function W(e,i){i.forEach(a=>{Object.getOwnPropertyNames(a.prototype).forEach(r=>{e.prototype[r]=a.prototype[r]})})}v.applyMixins=W;function X(...e){let i={};for(let a=0;a<e.length;a++){const r=e[a];r instanceof Object&&(i=Object.assign(Object.assign({},i),r))}return i}v.merge_obj=X;(function(e){var i=c&&c.__createBinding||(Object.create?function(r,t,n,o){o===void 0&&(o=n);var u=Object.getOwnPropertyDescriptor(t,n);(!u||("get"in u?!t.__esModule:u.writable||u.configurable))&&(u={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(r,o,u)}:function(r,t,n,o){o===void 0&&(o=n),r[o]=t[n]}),a=c&&c.__exportStar||function(r,t){for(var n in r)n!=="default"&&!Object.prototype.hasOwnProperty.call(t,n)&&i(t,r,n)};Object.defineProperty(e,"__esModule",{value:!0}),a(v,e)})(E);var L={},m={};Object.defineProperty(m,"__esModule",{value:!0});m.take_two_decimal_places=void 0;function Z(e){return Number(e).toFixed(2)}m.take_two_decimal_places=Z;(function(e){var i=c&&c.__createBinding||(Object.create?function(r,t,n,o){o===void 0&&(o=n);var u=Object.getOwnPropertyDescriptor(t,n);(!u||("get"in u?!t.__esModule:u.writable||u.configurable))&&(u={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(r,o,u)}:function(r,t,n,o){o===void 0&&(o=n),r[o]=t[n]}),a=c&&c.__exportStar||function(r,t){for(var n in r)n!=="default"&&!Object.prototype.hasOwnProperty.call(t,n)&&i(t,r,n)};Object.defineProperty(e,"__esModule",{value:!0}),a(m,e)})(L);var U={},M={};Object.defineProperty(M,"__esModule",{value:!0});M.awaitPromise=void 0;function k({getPromise:e,succeed:i=n=>{},error:a=()=>{},end:r=()=>{},midway:t=()=>{}}){let n=!1;return function(...o){n?t():(n=!0,e.apply(this,o).then(f=>{i(f)}).catch(a).finally(()=>{r(),n=!1}))}}M.awaitPromise=k;(function(e){var i=c&&c.__createBinding||(Object.create?function(r,t,n,o){o===void 0&&(o=n);var u=Object.getOwnPropertyDescriptor(t,n);(!u||("get"in u?!t.__esModule:u.writable||u.configurable))&&(u={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(r,o,u)}:function(r,t,n,o){o===void 0&&(o=n),r[o]=t[n]}),a=c&&c.__exportStar||function(r,t){for(var n in r)n!=="default"&&!Object.prototype.hasOwnProperty.call(t,n)&&i(t,r,n)};Object.defineProperty(e,"__esModule",{value:!0}),a(M,e)})(U);var K={},S={};Object.defineProperty(S,"__esModule",{value:!0});S._URL=void 0;class N{constructor(i){this.par_obj=N.getParameters(i)}static getParameters(i){let r=decodeURIComponent(i).match(/([^?=&]+)(=([^&]*))/g);return r===null?{}:r.reduce((n,o)=>(n[o.slice(0,o.indexOf("="))]=o.slice(o.indexOf("=")+1),n),{})}getValue(i){const a=this.par_obj[i];return a===void 0?"":a}}S._URL=N;(function(e){var i=c&&c.__createBinding||(Object.create?function(r,t,n,o){o===void 0&&(o=n);var u=Object.getOwnPropertyDescriptor(t,n);(!u||("get"in u?!t.__esModule:u.writable||u.configurable))&&(u={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(r,o,u)}:function(r,t,n,o){o===void 0&&(o=n),r[o]=t[n]}),a=c&&c.__exportStar||function(r,t){for(var n in r)n!=="default"&&!Object.prototype.hasOwnProperty.call(t,n)&&i(t,r,n)};Object.defineProperty(e,"__esModule",{value:!0}),a(S,e)})(K);var ee=c&&c.__createBinding||(Object.create?function(e,i,a,r){r===void 0&&(r=a);var t=Object.getOwnPropertyDescriptor(i,a);(!t||("get"in t?!i.__esModule:t.writable||t.configurable))&&(t={enumerable:!0,get:function(){return i[a]}}),Object.defineProperty(e,r,t)}:function(e,i,a,r){r===void 0&&(r=a),e[r]=i[a]}),te=c&&c.__setModuleDefault||(Object.create?function(e,i){Object.defineProperty(e,"default",{enumerable:!0,value:i})}:function(e,i){e.default=i}),D=c&&c.__importStar||function(e){if(e&&e.__esModule)return e;var i={};if(e!=null)for(var a in e)a!=="default"&&Object.prototype.hasOwnProperty.call(e,a)&&ee(i,e,a);return te(i,e),i};Object.defineProperty(_,"__esModule",{value:!0});_.string=_.promise=_.number=_.mixin=void 0;const ne=D(E);_.mixin=ne;const re=D(L);_.number=re;const ie=D(U);_.promise=ie;const ae=D(K);_.string=ae;var R={},$={};Object.defineProperty($,"__esModule",{value:!0});$.mergePluginPackage=void 0;function oe(e,i){return Object.assign(Object.assign({},i),{version:e.version,name:e.name,url:e.repository,author:e.author})}$.mergePluginPackage=oe;(function(e){var i=c&&c.__awaiter||function(t,n,o,u){function f(d){return d instanceof o?d:new o(function(l){l(d)})}return new(o||(o=Promise))(function(d,l){function g(b){try{B(u.next(b))}catch(T){l(T)}}function y(b){try{B(u.throw(b))}catch(T){l(T)}}function B(b){b.done?d(b.value):f(b.value).then(g,y)}B((u=u.apply(t,n||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0}),e.bindData=e.mergePluginPackage=void 0;const a=$;Object.defineProperty(e,"mergePluginPackage",{enumerable:!0,get:function(){return a.mergePluginPackage}});function r(t){const{that:n,storageName:o,initValue:u}=t;let f=u;const d=()=>i(this,void 0,void 0,function*(){const l=yield n.loadData(o);return l!==""&&(f=l),f});return d(),{loadValue:d,value:()=>f,set(l){f=l,n.saveData(o,f)}}}e.bindData=r})(R);var ue=c&&c.__createBinding||(Object.create?function(e,i,a,r){r===void 0&&(r=a);var t=Object.getOwnPropertyDescriptor(i,a);(!t||("get"in t?!i.__esModule:t.writable||t.configurable))&&(t={enumerable:!0,get:function(){return i[a]}}),Object.defineProperty(e,r,t)}:function(e,i,a,r){r===void 0&&(r=a),e[r]=i[a]}),ce=c&&c.__setModuleDefault||(Object.create?function(e,i){Object.defineProperty(e,"default",{enumerable:!0,value:i})}:function(e,i){e.default=i}),O=c&&c.__importStar||function(e){if(e&&e.__esModule)return e;var i={};if(e!=null)for(var a in e)a!=="default"&&Object.prototype.hasOwnProperty.call(e,a)&&ue(i,e,a);return ce(i,e),i};Object.defineProperty(s,"__esModule",{value:!0});var x=s.siyuan=s.js_core=s.adap=s.hash=s.decorator=void 0;const le=O(j);s.decorator=le;const fe=O(A);s.hash=fe;const de=O(w);s.adap=de;const se=O(_);s.js_core=se;const _e=O(R);x=s.siyuan=_e;const{Plugin:ge}=require("siyuan");class be extends ge{constructor(){super(...arguments);h(this,"onunloadFn",[])}addUnloadFn(a){this.onunloadFn.push(a)}onunload(){this.onunloadFn.forEach(a=>a())}}class pe extends be{constructor(){super(...arguments);h(this,"tagSort",x.bindData({initValue:{},that:this,storageName:"tagSort.json"}));h(this,"toolkit_setting",x.bindData({initValue:{tag_sort_reverse:!1},that:this,storageName:"toolkit_setting.json"}))}onload(){globalThis.ToolKitPlugin=this,this.addUnloadFn(()=>{globalThis.ToolKitPlugin=void 0}),this.fn_tagSort(),this.addCommand({hotkey:"",langKey:"conflicted Comparison",langText:"conflicted Comparison",callback:()=>{this.fn_conflictedComparison()}})}async fn_tagSort(){const a=globalThis.fetch;globalThis.fetch=async(t,n)=>{const o=await a(t,n);if(t==="/api/search/searchTag"){const u=await o.clone().json();return u.data.tags=u.data.tags.sort((d,l)=>{const g=d.replace(/<mark>(.*?)<\/mark>/g,"$1"),y=l.replace(/<mark>(.*?)<\/mark>/g,"$1");return(this.tagSort.value()[g]??0)-(this.tagSort.value()[y]??0)}),this.toolkit_setting.value().tag_sort_reverse||u.data.tags.reverse(),new Response(JSON.stringify(u),{status:200,headers:{"Content-Type":"application/json"}})}return o},this.addUnloadFn(()=>{globalThis.fetch=a});const r=t=>{if(t.target instanceof HTMLElement&&t.target.classList.contains("b3-list-item__text")){const n=t.target.textContent??"";this.tagSort.set({...this.tagSort.value(),[n]:this.tagSort.value()[n]?this.tagSort.value()[n]+1:1})}};document.addEventListener("click",r,{capture:!0}),this.addUnloadFn(()=>{document.removeEventListener("click",r,{capture:!0})})}async fn_conflictedComparison(){const[a,r]=document.querySelectorAll(".layout__center .protyle:not(.fn__none) .protyle-content"),t=document.querySelector(".layout__center .layout__resize");if(t==null||t.addEventListener("wheel",f=>{a.scrollTop+=f.deltaY,r.scrollTop+=f.deltaY}),a===void 0||r===void 0)return;const n=[...a.querySelectorAll("[data-node-id][updated]")],o=[...r.querySelectorAll("[data-node-id][updated]")];u(n,o),u(o,n);function u(f,d){d.forEach(l=>{f.find(y=>y.getAttribute("updated")===l.getAttribute("updated"))===void 0&&(l.style.outline="1px solid red")})}}}module.exports=pe;
//# sourceMappingURL=index.js.map
